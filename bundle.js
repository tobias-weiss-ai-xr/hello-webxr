!function(e){function t(t){for(var n,i,s=t[0],c=t[1],l=t[2],h=0,u=[];h<s.length;h++)i=s[h],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(d&&d(t);u.length;)u.shift()();return a.push.apply(a,l||[]),o()}function o(){for(var e,t=0;t<a.length;t++){for(var o=a[t],n=!0,s=1;s<o.length;s++){var c=o[s];0!==r[c]&&(n=!1)}n&&(a.splice(t--,1),e=i(i.s=o[0]))}return e}var n={},r={0:0},a=[];function i(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=n,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="./";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=c;a.push([12,1,2]),o()}({12:function(e,t,o){"use strict";o.r(t),o.d(t,"init",(function(){return Dt}));var n={};o.r(n),o.d(n,"setup",(function(){return ae})),o.d(n,"enter",(function(){return ie})),o.d(n,"exit",(function(){return se})),o.d(n,"execute",(function(){return ce}));var r={};o.r(r),o.d(r,"setup",(function(){return fe})),o.d(r,"enter",(function(){return we})),o.d(r,"exit",(function(){return ye})),o.d(r,"execute",(function(){return ge}));var a={};o.r(a),o.d(a,"setup",(function(){return Pe})),o.d(a,"enter",(function(){return Ee})),o.d(a,"exit",(function(){return ze})),o.d(a,"execute",(function(){return Ge}));var i={};o.r(i),o.d(i,"setup",(function(){return ke})),o.d(i,"enter",(function(){return Oe})),o.d(i,"exit",(function(){return Ae})),o.d(i,"execute",(function(){return Re}));var s={};o.r(s),o.d(s,"setup",(function(){return Ue})),o.d(s,"enter",(function(){return Xe})),o.d(s,"exit",(function(){return Ye})),o.d(s,"execute",(function(){return $e}));var c={};o.r(c),o.d(c,"setup",(function(){return ot})),o.d(c,"enter",(function(){return nt})),o.d(c,"exit",(function(){return rt})),o.d(c,"execute",(function(){return at}));var l=o(0),d=o(4),h=function(e,t){function o(){r.style.display="",r.style.cursor="auto",r.style.left="calc(50% - 75px)",r.style.width="150px",r.onmouseenter=null,r.onmouseleave=null,r.onclick=null,r.textContent="VR NOT SUPPORTED"}function n(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 24px",e.style.border="2px solid #fff",e.style.borderRadius="6px",e.style.background="rgba(0,0,0,0.7)",e.style.color="#fff",e.style.font="600 14px sans-serif",e.style.textAlign="center",e.style.opacity="1.0",e.style.outline="none",e.style.zIndex="999",e.style.cursor="pointer",e.style.transition="all 0.2s ease"}if("xr"in navigator){var r=document.createElement("button");return r.style.display="none",n(r),navigator.xr.isSessionSupported("immersive-vr").then((function(n){n?function(){var o=null;function n(n){n.addEventListener("end",a),e.xr.setSession(n),r.textContent="EXIT VR",o=n,t("sessionStarted")}function a(){o.removeEventListener("end",a),r.textContent="ENTER VR",o=null,t("sessionEnded")}r.style.display="",r.style.cursor="pointer",r.style.left="calc(50% - 50px)",r.style.width="100px",r.textContent="ENTER VR",r.onmouseenter=function(){r.style.background="rgba(0,0,0,0.9)",r.style.transform="scale(1.05)"},r.onmouseleave=function(){r.style.background="rgba(0,0,0,0.7)",r.style.transform="scale(1.0)"},r.onclick=function(){if(null===o){navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(n)}else o.end()}}():o()})),r}var a=document.createElement("a");return!1===window.isSecureContext?(a.href=document.location.href.replace(/^http:/,"https:"),a.innerHTML="WEBXR NEEDS HTTPS"):(a.href="https://immersiveweb.dev/",a.innerHTML="WEBXR NOT AVAILABLE"),a.style.left="calc(50% - 90px)",a.style.width="180px",a.style.textDecoration="none",n(a),a};var u={};u.paths=[[{from:new l.Vector3(0,1.6,0),lookAt:new l.Vector3(0,1,-100),velocity:new l.Vector3(0,0,-.1),angularVelocity:new l.Vector3(.04,0,0)},{from:new l.Vector3(4.5,1.6,-3),lookAt:new l.Vector3(100,0,0),velocity:new l.Vector3(0,0,-.15),angularVelocity:new l.Vector3(0,0,0)},{from:new l.Vector3(0,1.6,0),lookAt:new l.Vector3(50,0,-40),velocity:new l.Vector3(0,.12,0),angularVelocity:new l.Vector3(0,.1,0)},{from:new l.Vector3(3,2.4,-4),lookAt:new l.Vector3(-50,0,40),velocity:new l.Vector3(0,-.12,0),angularVelocity:new l.Vector3(0,-.1,0)}],[{from:new l.Vector3(0,1.6,0),lookAt:new l.Vector3(0,0,-100),velocity:new l.Vector3(.1,0,.1),angularVelocity:new l.Vector3(0,.01,0)}],[{from:new l.Vector3(0,1.2,.8),lookAt:new l.Vector3(-100,.5,0),velocity:new l.Vector3(0,0,-.2),angularVelocity:new l.Vector3(0,0,0)},{from:new l.Vector3(-1,1,-1.6),lookAt:new l.Vector3(-40,0,100),velocity:new l.Vector3(-.05,0,0),angularVelocity:new l.Vector3(0,0,0)}],[{from:new l.Vector3(0,1.6,0),lookAt:new l.Vector3(0,0,-10),velocity:new l.Vector3(0,0,0),angularVelocity:new l.Vector3(-.01,.07,0)},{from:new l.Vector3(0,1.6,-.4),lookAt:new l.Vector3(0,0,6),velocity:new l.Vector3(0,0,.1),angularVelocity:new l.Vector3(.07,0,0)}],[{from:new l.Vector3(0,0,0),lookAt:new l.Vector3(-100,0,0),velocity:new l.Vector3(0,0,0),angularVelocity:new l.Vector3(.03,.05,0)}],[],[{from:new l.Vector3(0,0,0),lookAt:new l.Vector3(-100,0,0),velocity:new l.Vector3(0,0,0),angularVelocity:new l.Vector3(.01,.1,0)}],[],[{from:new l.Vector3(0,0,0),lookAt:new l.Vector3(-100,0,0),velocity:new l.Vector3(0,0,0),angularVelocity:new l.Vector3(-.07,-.05,0)}],[{from:new l.Vector3(0,0,0),lookAt:new l.Vector3(100,0,80),velocity:new l.Vector3(0,0,0),angularVelocity:new l.Vector3(0,-.02,0)}]],u.setup=function(e){this.room=void 0,this.path=void 0,this.next(e),e.camera.position.set(0,1.6,0),e.cameraRig.position.set(0,0,2),e.goto=this.room},u.next=function(e){if(this.time=3+3*Math.random()/2,void 0===this.room)this.room=0,this.path=0;else if(this.path++,this.path>=this.paths[this.room].length){do{this.room++,this.room>=this.paths.length&&(this.room=0,e.cameraRig.position.set(0,0,2))}while(!this.paths[this.room].length);e.renderer.xr.getCamera(e.camera).position.set(0,1.6,0),e.goto=this.room,this.path=0}this.reset=!0},u.execute=function(e,t,o){const n=this.paths[this.room][this.path];this.reset&&(this.reset=!1,e.camera.position.copy(n.from),e.camera.rotation.set(0,0,0),e.camera.lookAt(n.lookAt)),e.camera.position.addScaledVector(n.velocity,t),e.camera.rotation.x+=n.angularVelocity.x*t,e.camera.rotation.y+=n.angularVelocity.y*t,e.camera.rotation.z+=n.angularVelocity.z*t,this.time-=t,this.time<0&&this.next(e)};var m=o(5),p=o(6),v=o(7),f=o(8);function w(e){let t=0;for(var o in e)!0!==e[o].loading&&t++;return t}function y(e){for(var t in e)if(!0===e[t].loading)return!1;return!0}var g=o(1),M=o(3);class x{constructor(){this.value=null}reset(){this.value=null}}class b{constructor(){this.rotation=new l.Vector3}reset(){}}class S{constructor(){this.position=new l.Vector3}reset(){}}class C{constructor(){this.value=null}reset(){this.value=null}}class B{constructor(){this.text="",this.textAlign="left",this.anchor="center",this.baseline="center",this.color="#FFF",this.font=null,this.fontSize=.2,this.letterSpacing=0,this.lineHeight=0,this.maxWidth=1/0,this.overflowWrap="normal",this.whiteSpace="normal",this.opacity=1}reset(){this.text=""}}class P{constructor(){this.min=new l.Vector3,this.max=new l.Vector3}reset(){this.min.set(0,0,0),this.max.set(0,0,0)}}g.d;g.d;class E extends g.d{}class z{constructor(){}reset(){}}const G=()=>{};class D{constructor(){this.reset()}reset(){this.onEntering=G,this.onExiting=G}}class V extends g.d{}class _{constructor(){this.value=[]}reset(){this.value.array.length=0}}const H={left:0,center:.5,right:1},L={top:0,center:.5,bottom:1};class I extends g.b{updateText(e,t){e.text=t.text,e.textAlign=t.textAlign,e.anchor[0]=H[t.anchor],e.anchor[1]=L[t.baseline],e.color=t.color,e.font=t.font,e.fontSize=t.fontSize,e.letterSpacing=t.letterSpacing||0,e.lineHeight=t.lineHeight||null,e.overflowWrap=t.overflowWrap,e.whiteSpace=t.whiteSpace,e.maxWidth=t.maxWidth,e.material.opacity=t.opacity,e.sync()}execute(e,t){var o=this.queries.entities;o.added.forEach(e=>{var t=e.getComponent(B);const o=new M.a;o.name="textMesh",o.anchor=[0,0],o.renderOrder=1,this.updateText(o,t),e.addComponent(x,{value:o})}),o.removed.forEach(e=>{var t=e.getComponent(x).value,o=t.getObjectByName("textMesh");o.dispose(),t.remove(o)}),o.changed.forEach(e=>{var t=e.getComponent(x).value;if(t instanceof M.a){var o=e.getComponent(B);this.updateText(t,o)}})}}I.queries={entities:{components:[B],listen:{added:!0,removed:!0,changed:[B]}}},l.BoxHelper.prototype.setFromMinMax=function(e,t){var o=this.geometry.attributes.position,n=o.array;n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=e.x,n[4]=t.y,n[5]=t.z,n[6]=e.x,n[7]=e.y,n[8]=t.z,n[9]=t.x,n[10]=e.y,n[11]=t.z,n[12]=t.x,n[13]=t.y,n[14]=e.z,n[15]=e.x,n[16]=t.y,n[17]=e.z,n[18]=e.x,n[19]=e.y,n[20]=e.z,n[21]=t.x,n[22]=e.y,n[23]=e.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()};class k extends g.c{constructor(){super(),this.boxHelper=new l.BoxHelper}}class O extends g.b{execute(e,t){this.queries.added.results.forEach(e=>{e.addComponent(k);var t=e.getComponent(P);let o=e.getMutableComponent(k);o.boxHelper.setFromMinMax(t.min,t.max),e.addComponent(x,{value:o.boxHelper})}),this.queries.removed.results.forEach(e=>{e.removeComponent(x).removeComponent(k)})}}O.queries={added:{components:[V,Object(g.a)(k)]},removed:{components:[Object(g.a)(V),k]}};class A extends g.b{execute(e,t){const o=this.queries.areas.results,n=this.queries.checkers.results;for(let e=0;e<o.length;e++){const t=o[e].getComponent(P);for(let e=0;e<n.length;e++){const o=n[e];o.getComponent(x).value.boundingBox.intersectsBox(t)?o.addComponent(E):o.removeComponent(E)}}}}A.queries={areas:{components:[class{constructor(){}reset(){}},P]},checkers:{components:[z,x]}};class R extends g.b{execute(e,t){const o=this.queries.checkers.added,n=this.queries.checkers.removed;for(let e=0;e<o.length;e++){const t=o[e];t.getComponent(D).onEntering(t)}for(let e=0;e<n.length;e++){const t=n[e];t.getComponent(D).onExiting(t)}}}R.queries={checkers:{components:[z,x,E],listen:{added:!0,removed:!0}}};class j extends g.b{execute(e,t){this.queries.entities.added.forEach(e=>{const t=e.getComponent(C).value,o=e.getComponent(x).value;t.add(o)}),this.queries.entities.changed.forEach(e=>{const t=e.getComponent(C).value,o=e.getComponent(x).value;t.add(o)}),this.queries.entities.removed.forEach(e=>{e.getComponent(C,!0).value.remove(e.getComponent(x,!0).value)})}}j.queries={entities:{components:[x,C],listen:{added:!0,removed:!0,changed:!0}}};let T=e=>{const t=e.getComponent(b);e.getComponent(x).value.rotation.set(t.x,t.y,t.z)},W=e=>{const t=e.getComponent(S);e.getComponent(x).value.position.copy(t)};class F extends g.b{execute(e,t){this.queries.position.added.forEach(W),this.queries.position.changed.forEach(W),this.queries.rotation.added.forEach(T),this.queries.rotation.changed.forEach(T)}}F.queries={position:{components:[S,x],listen:{added:!0,changed:!0}},rotation:{components:[b,x],listen:{added:!0,changed:!0}}};var N=new l.Vector3;class q extends g.b{execute(e,t){window.context.camera.getWorldPosition(N),this.queries.entities.results.forEach(e=>{const t=e.getComponent(x).value,o=N.distanceTo(t.position);let n=0;o<4&&(n=l.Math.clamp(Math.sqrt(4-o),0,1),t.lookAt(N)),t.material.opacity=n,e.hasComponent(_)&&e.getComponent(_).value.forEach(e=>{e.getComponent(B).opacity!==n&&(e.getMutableComponent(B).opacity=n)})})}}q.queries={entities:{components:[class{constructor(){this.camera3D=null}reset(){this.camera3D=null}},x]}};class U{constructor(e,t){this.Systems=t,this.world=e}play(){this.Systems.forEach(e=>this.world.getSystem(e).play())}stop(){this.Systems.forEach(e=>this.world.getSystem(e).stop())}}var X={doorfx_tex:{url:"doorfx.basis",options:{wrapT:l.RepeatWrapping,wrapS:l.RepeatWrapping}},generic_controller_model:{url:"generic_controller.glb"},controller_tex:{url:"controller.basis"},teleport_model:{url:"teleport.glb"},glow_tex:{url:"glow.basis",options:{encoding:l.sRGBEncoding}},beam_tex:{url:"beamfx.png"}};var Y,$=new l.Matrix4;const J=["primary","secondary","both","left","right"];class Z extends class{constructor(){this._listeners={},this.stats={fired:0,handled:0}}addEventListener(e,t){let o=this._listeners;void 0===o[e]&&(o[e]=[]),-1===o[e].indexOf(t)&&o[e].push(t)}hasEventListener(e,t){return void 0!==this._listeners[e]&&-1!==this._listeners[e].indexOf(t)}removeEventListener(e,t){var o=this._listeners[e];if(void 0!==o){var n=o.indexOf(t);-1!==n&&o.splice(n,1)}}dispatchEvent(e,t){this.stats.fired++;var o=this._listeners[e];if(void 0!==o)for(var n=o.slice(0),r=0;r<n.length;r++)n[r].call(this,t)}resetCounters(){this.stats.fired=this.stats.handled=0}}{enable(){this.setLineStyle(this.previousLineStyle),this.enabled=!0}_sort(){this.currentStates=this.currentStates.sort((e,t)=>(e.order||0)-(t.order||0))}disable(){this.lineBasic.visible=this.line0.visible=!1,this.enabled=!1,this.controllers.forEach(e=>e.active=!1)}changeHandedness(e){e!==this.primary&&(this.primary=e,this.secondary="right"===e?"left":"right",this.dispatchEvent("handednessChanged",{primary:this.primary,secondary:this.secondary}))}addState(e,t,o){if(!this.states[e])return t.name=e,void 0===t.raycaster&&(t.raycaster=!0),void 0===t.controller?t.controller="primary":J.includes(t.controller)||(console.warn("Invalid controller selector:",t.controller),t.controller="primary"),this.states[e]=t,!0===o&&this.currentStates.push(t),t;console.error(`RayControl state '${e}' already exist, please use a different name.`)}activateState(e){this.states[e]&&(this.currentStates.push(this.states[e]),this._sort())}deactivateAll(e){this.currentStates=[],this.controllers.forEach(e=>{this.currentStates.forEach(t=>{e.intersections[t.name]&&(e.intersections[t.name]=null)})})}deactivateState(e){this.currentStates.splice(this.currentStates.indexOf(e),1),this.controllers.forEach(t=>{t.intersections[e]&&(t.intersections[e]=null)}),this._sort()}addController(e,t){let o={controller:e,inputSource:t,active:!1,stateHit:{},intersections:{},currentIntersection:null,hit:!1};this.controllers.push(o),this.matchController(o,"primary")&&e.add(this.raycasterContext),this.dispatchEvent("controllerConnected",o)}removeController(e){const t=this.controllers.findIndex(t=>t.controller===e),o=this.controllers.find(t=>t.controller===e);this.controllers.splice(t,1),this.dispatchEvent("controllerDisconnected",o)}constructor(e,t){super(),this.ctx=e,void 0===t?(this.primary="right",this.secondary="left"):(this.primary=t,this.secondary="right"===t?"left":"right"),this.controllers=[],this.previousLineStyle="pretty",this.enabled=!0,this.raycaster=new l.Raycaster,this.states={},this.currentStates=[];var o=e.assets.teleport_model.scene.getObjectByName("beam");e.assets.beam_tex.wrapT=l.RepeatWrapping,e.assets.beam_tex.wrapS=l.RepeatWrapping,Y=o.material=new l.ShaderMaterial({uniforms:{time:{value:0},active:{value:0},tex:{value:e.assets.beam_tex}},vertexShader:e.shaders.basic_vert,fragmentShader:e.shaders.beam_frag,blending:l.AdditiveBlending,transparent:!0}),o.renderOrder=10,o.name="line",this.rayLength=5,o.scale.z=this.rayLength,this.line0=o.clone(),this.line0.visible=!0,this.raycasterContext=new l.Group,this.raycasterContext.add(this.line0),this.raycasterContext.name="raycasterContext";var n=(new l.BufferGeometry).setFromPoints([new l.Vector3(0,0,0),new l.Vector3(0,0,-1)]);this.lineBasic=new l.Line(n),this.lineBasic.name="line",this.lineBasic.scale.z=5,this.lineBasic.visible=!1,this.raycasterContext.add(this.lineBasic)}setLineStyle(e){const t="basic"===e;this.lineBasic.visible=t,this.line0.visible=!t,this.previousLineStyle=e}matchController(e,t){const o=e.inputSource.handedness;return t===o||"both"===t&&("right"===o||"left"===o)||"primary"===t&&this.primary===o||"secondary"===t&&this.secondary===o}onSelectStart(e){if(!this.enabled)return;let t=e.target,o=this.controllers.find(e=>e.controller===t);if(o){if(o.active=!0,o.currentIntersection){const e=o.currentIntersection.state;e.onSelectStart&&e.onSelectStart(o.currentIntersection.intersection,o.controller)}this.currentStates.forEach(e=>{e.onSelectStart&&!e.raycaster&&e.onSelectStart(o.intersections[e.name],t)})}}execute(e,t,o){if(!this.enabled||0===this.currentStates.length)return;Y.uniforms.time.value=o;for(var n=0;n<this.controllers.length;n++){let e=this.controllers[n];for(var r=0;r<this.currentStates.length;r++){let t=this.currentStates[r];if(!t.raycaster)continue;if(!this.matchController(e,t.controller))continue;let o=e.controller,n=(e.active,this.getIntersections(o,t.colliderMesh));n.length>0?(e.intersections[t.name]=n[0],e.stateHit[t.name]=!0):e.intersections[t.name]=null}}this.line0.scale.z=Math.min(this.rayLength,1),this.lineBasic.scale.z=Math.min(this.rayLength,1);for(n=0;n<this.controllers.length;n++){let e=this.controllers[n],t=Object.entries(e.intersections).filter(e=>null!==e[1]);if(t.length>0){t.sort((e,t)=>e[1].distance-t[1].distance);const o=t[0],n=o[1],r=this.states[o[0]];e.prevIntersection=e.currentIntersection,e.currentIntersection={state:r,intersection:n},r.lineStyleOnIntersection?this.setLineStyle(r.lineStyleOnIntersection):this.setLineStyle("advanced"),r.onHover&&r.onHover(n,e.active,e.controller),this.line0.scale.z=Math.min(n.distance,1),this.lineBasic.scale.z=Math.min(n.distance,1)}else e.currentIntersection=null}for(n=0;n<this.controllers.length;n++){let e=this.controllers[n];e.prevIntersection&&(this.controllers.find(t=>{let o=e.prevIntersection,n=t.currentIntersection;return n&&o.state.name===n.state.name&&o.intersection.object===n.intersection.object})||(e.prevIntersection.state.onHoverLeave(e.prevIntersection.intersection,!1,e.controller),e.prevIntersection=null))}}getIntersections(e,t){let o=e.getObjectByName("raycasterContext");return o?($.identity().extractRotation(o.matrixWorld),this.raycaster.ray.origin.setFromMatrixPosition(o.matrixWorld),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4($),Array.isArray(t)?this.raycaster.intersectObjects(t,!0):this.raycaster.intersectObject(t,!0)):(console.warn("No raycasterContext found for this controller",e),[])}onSelectEnd(e){if(!this.enabled)return;let t=this.controllers.find(t=>t.controller===e.target);if(t&&t.active){if(t){if(t.currentIntersection){const e=t.currentIntersection.state;e.onSelectEnd&&e.onSelectEnd(t.currentIntersection.intersection,t.controller)}this.currentStates.forEach(e=>{e.onSelectEnd&&!e.raycaster&&e.onSelectEnd(null,t.controller)})}t.active=!1}}}new l.Matrix4;class K{constructor(e,t){this.ctx=e,this.teleportEntity=new l.Group,this.active=!1,this.teleportHitGeometry=e.assets.teleport_model.scene.getObjectByName("goal"),this.teleportHitGeometry.material=Y,this.teleportHitGeometry.renderOrder=10,this.ballColliding=e.assets.teleport_model.scene.getObjectByName("glow"),this.ballColliding.material=new l.MeshBasicMaterial({color:9595,map:e.assets.glow_tex,transparent:!0,blending:l.AdditiveBlending}),this.ballColliding.renderOrder=10,this.ballColliding.visible=!1,this.teleportEntity.add(this.ballColliding),this.teleportHitGeometry.visible=!1,this.teleportHitGeometry.position.set(-2,0,-2),this.teleportEntity.add(this.teleportHitGeometry),this.ctx.scene.add(this.teleportEntity);try{this.startSound=new l.Audio(e.audioListener),this.startSound.setBuffer(e.assets.teleport_a_snd),this.startSound.setLoop(!0),this.startSound.pause()}catch(e){console.warn("Failed to initialize start sound:",e),this.startSound=null}try{this.endSound=new l.Audio(e.audioListener),this.endSound.setBuffer(e.assets.teleport_b_snd),this.endSound.setLoop(!1),this.endSound.pause()}catch(e){console.warn("Failed to initialize end sound:",e),this.endSound=null}}onSelectStart(e){this.active=!0,this.endSound&&this.endSound.pause(),this.startSound&&this.startSound.play()}onHoverLeave(){this.ballColliding.visible=!1,this.teleportHitGeometry.visible=!1,this.startSound&&this.startSound.pause()}onHover(e,t){t?(this.teleportHitGeometry.visible=!0,this.teleportHitGeometry.position.copy(e),this.hit=!0,this.ballColliding.visible=!1):(this.ballColliding.visible=!0,this.ballColliding.position.copy(e))}onSelectEnd(e){const t=this.ctx.renderer.xr.getCamera(this.ctx.camera).position,o=e.sub(t);o.y=0,this.ctx.cameraRig.position.add(o),this.teleportHitGeometry.visible=!1,this.active=!1,this.startSound&&this.startSound.pause(),this.endSound&&this.endSound.play()}}var Q,ee=[],te=[],oe=[];const ne=[{id:"controllers",name:"VR Controllers",description:"Learn how VR controllers provide 6DOF (6 Degrees of Freedom) input tracking",color:4886754,icon:"ðŸŽ®"},{id:"teleport",name:"Teleportation",description:"Move through VR spaces using ray-casting and point-to-click navigation",color:5301186,icon:"âš¡"},{id:"models",name:"3D Models",description:"Display and interact with 3D content in VR: glTF, DRACO compression, materials",color:16098851,icon:"ðŸŽ¨"},{id:"audio",name:"Spatial Audio",description:"Positional audio that creates immersive 3D soundscapes",color:14702333,icon:"ðŸ”Š"},{id:"interaction",name:"Ray Control",description:"Interact with objects using laser pointers and grab mechanics",color:16739179,icon:"ðŸ‘†"}];function re(e,t,o,n){const r=o/n*Math.PI*2,a=7.5*Math.cos(r),i=7.5*Math.sin(r),s=new l.BoxGeometry(1.5,2.5,.1),c=function(e,t){return new l.ShaderMaterial({uniforms:{time:{value:0},selected:{value:0},tex:{value:e.assets.doorfx_tex},doorColor:{value:new l.Color(t)}},vertexShader:e.shaders.basic_vert,fragmentShader:e.shaders.door_frag})}(e,t.color),d=new l.Mesh(s,c);d.position.set(a,1.25,i),d.lookAt(0,1.25,0),d.name=t.id,d.userData.elementId=o+1;const h=new l.BoxGeometry(1.7,2.7,.08),u=new l.MeshBasicMaterial({color:1710618}),m=new l.Mesh(h,u);return m.position.copy(d.position),m.position.z+=i<0?-.05:.05,m.position.x+=a<0?-.05:.05,m.lookAt(0,1.25,0),{door:d,frame:m}}function ae(e){Q=new l.Scene;const t=new l.CylinderGeometry(10,10,.2,64),o=new l.MeshBasicMaterial({color:1710638}),n=new l.Mesh(t,o);n.position.y=-.1,Q.add(n);const r=new l.CylinderGeometry(3,3,.3,32),a=new l.MeshBasicMaterial({color:2763338}),i=new l.Mesh(r,a);i.position.y=.15,Q.add(i);const s=new l.CylinderGeometry(.5,.6,3,16),c=new l.MeshBasicMaterial({color:3816026}),d=new l.Mesh(s,c);d.position.y=1.5,Q.add(d),ne.forEach((t,o)=>{const{group:n,icon:r,panel:a}=function(e,t,o){const n=new l.Group,r=t/o*Math.PI*2,a=6*Math.cos(r),i=6*Math.sin(r),s=new l.BoxGeometry(2.5,1.8,.1),c=new l.MeshBasicMaterial({color:2763322}),d=new l.Mesh(s,c);d.position.set(a,1.5,i),d.lookAt(0,1.5,0),n.add(d);const h=new l.PlaneGeometry(2.3,.4),u=new l.MeshBasicMaterial({color:e.color}),m=new l.Mesh(h,u);m.position.set(0,.6,.06),m.name="titlePlate_"+e.id,d.add(m);const p=new l.PlaneGeometry(2.3,1),v=new l.MeshBasicMaterial({color:1710634}),f=new l.Mesh(p,v);f.position.set(0,-.2,.06),f.name="descPlate_"+e.id,d.add(f);const w=new l.BoxGeometry(1.5,.6,1.5),y=new l.MeshBasicMaterial({color:1710634}),g=new l.Mesh(w,y);g.position.set(a,.3,i),n.add(g);const M=new l.SphereGeometry(.3,16,16),x=new l.MeshBasicMaterial({color:e.color}),b=new l.Mesh(M,x);return b.position.set(a,.9,i),n.add(b),b.userData.baseY=.9,b.userData.offset=Math.random()*Math.PI*2,{group:n,icon:b,panel:d,position:new l.Vector3(a,0,i)}}(t,o,ne.length);Q.add(n),te.push({icon:r,element:t,panel:a});const i=a.getObjectByName("titlePlate_"+t.id),s=a.getObjectByName("descPlate_"+t.id);if(i){const o=e.world.createEntity();o.addComponent(B,{text:`${t.icon} ${t.name}`,color:"#ffffff",fontSize:.08,anchor:"center",baseline:"middle",textAlign:"center"}).addComponent(C,{value:i}).addComponent(S,{x:0,y:0,z:.01});e.world.createEntity().addComponent(x,{value:i}).addComponent(_,{value:[o]}),oe.push(o)}if(s){const o=e.world.createEntity();o.addComponent(B,{text:t.description,color:"#cccccc",fontSize:.045,anchor:"center",baseline:"top",textAlign:"center",maxWidth:2.1,lineHeight:1.4}).addComponent(C,{value:s}).addComponent(S,{x:0,y:.45,z:.01});e.world.createEntity().addComponent(x,{value:s}).addComponent(_,{value:[o]}),oe.push(o)}const{door:c,frame:d}=re(e,t,o,ne.length);Q.add(c),Q.add(d),ee.push(c)});const h=new l.SphereGeometry(10,32,16,0,2*Math.PI,0,Math.PI/2),u=new l.MeshBasicMaterial({color:657946,side:l.DoubleSide}),m=new l.Mesh(h,u);Q.add(m);const p=new l.AmbientLight(16777215,.3);Q.add(p);const v=new l.PointLight(4886754,.5,10);v.position.set(5,3,0),Q.add(v);const f=new l.PointLight(14702333,.5,10);f.position.set(-5,3,0),Q.add(f);const w=new l.PlaneBufferGeometry(20,20),y=new l.MeshBasicMaterial({visible:!1}),g=new l.Mesh(w,y);g.rotation.x=-Math.PI/2,g.position.y=.001,Q.add(g),Q.userData.teleport=g,Q.userData.infoPanels=te,Q.userData.doorMaterials=ee.map(e=>e.material),e.raycontrol.addState("landingDoors",{colliderMesh:ee,onHover:(e,t)=>{const o=e.object;o.scale.z=Math.min(o.scale.z+.05*(2-o.scale.z),2)},onHoverLeave:e=>{},onSelectStart:(t,o)=>{e.goto=t.object.userData.elementId},onSelectEnd:e=>{}}),e.raycontrol.addState("landingTeleport",{colliderMesh:g,onHover:(t,o)=>{e.teleport.onHover(t.point,o)},onHoverLeave:()=>{e.teleport.onHoverLeave()},onSelectStart:(t,o)=>{e.teleport.onSelectStart(o)},onSelectEnd:t=>{e.teleport.onSelectEnd(t.point)}})}function ie(e){e.renderer.setClearColor(657946),e.scene.add(Q),e.raycontrol.activateState("landingDoors"),e.raycontrol.activateState("landingTeleport")}function se(e){e.raycontrol.deactivateState("landingDoors"),e.raycontrol.deactivateState("landingTeleport"),e.scene.remove(Q)}function ce(e,t,o){te.forEach(({icon:e,element:n})=>{e.position.y=e.userData.baseY+.1*Math.sin(2*o+e.userData.offset),e.rotation.y+=.5*t}),ee.forEach(e=>{e.material.uniforms&&(e.material.uniforms.time.value=o),e.scale.z>1&&(e.scale.z=Math.max(e.scale.z-t*e.scale.z,1))})}var le,de,he,ue=[],me=[];const pe=[{title:"6DOF Tracking",description:"Position (X,Y,Z) and Rotation (Pitch,Yaw,Roll) tracking",color:4886754},{title:"Buttons & Triggers",description:"Trigger, Grip, A/B/X/Y buttons, Joystick, Menu",color:5301186},{title:"Haptic Feedback",description:"Vibration pulses for tactile feedback",color:16098851},{title:"Ray Casting",description:"Laser pointer for distant object interaction",color:14702333}];function ve(e,t,o){const n=new l.Group,r=new l.BoxGeometry(1.5,.8,1.5),a=new l.MeshBasicMaterial({color:1710634}),i=new l.Mesh(r,a);i.position.set(t,.4,o),n.add(i);const s=new l.CylinderGeometry(.8,.9,.1,32),c=new l.MeshBasicMaterial({color:3816026}),d=new l.Mesh(s,c);if(d.position.set(t,.85,o),n.add(d),e.assets.generic_controller_model){const r=e.assets.generic_controller_model.scene.clone();r.position.set(t,1.2,o),r.scale.set(2,2,2),r.userData.rotating=!0,n.add(r),ue.push(r)}else{const e=new l.BoxGeometry(.15,.25,.08),r=new l.MeshBasicMaterial({color:4886754}),a=new l.Mesh(e,r);a.position.set(t,1.2,o),a.userData.rotating=!0,n.add(a),ue.push(a);const i=new l.BoxGeometry(.03,.08,.03),s=new l.MeshBasicMaterial({color:2763306}),c=new l.Mesh(i,s);c.position.set(0,.05,.055),a.add(c)}return n}function fe(e){e.assets;le=new l.Scene;const t=new l.PlaneGeometry(10,10),o=new l.MeshBasicMaterial({color:1710638}),n=new l.Mesh(t,o);n.rotation.x=-Math.PI/2,le.add(n);const r=new l.MeshBasicMaterial({color:2767434}),a=new l.Mesh(new l.PlaneGeometry(10,4),r);a.position.set(0,2,-5),le.add(a);const i=new l.Mesh(new l.PlaneGeometry(10,4),r);i.position.set(-5,2,0),i.rotation.y=Math.PI/2,le.add(i);const s=new l.Mesh(new l.PlaneGeometry(10,4),r);s.position.set(5,2,0),s.rotation.y=-Math.PI/2,le.add(s);const c=new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:657950}));c.rotation.x=Math.PI/2,c.position.y=4,le.add(c);const d=new l.PlaneGeometry(6,1),h=new l.MeshBasicMaterial({color:4886754}),u=new l.Mesh(d,h);u.position.set(0,3.5,-4.9),le.add(u),ve(e,-3,-2),ve(e,3,-2),ve(e,-3,2),ve(e,3,2),pe.forEach((t,o)=>{const n=function(e,t,o,n,r){const a=new l.Group,i=new l.BoxGeometry(2,1.2,.1),s=new l.MeshBasicMaterial({color:2763322}),c=new l.Mesh(i,s);c.position.set(o,n,r),a.add(c);const d=new l.PlaneGeometry(1.9,.3),h=new l.MeshBasicMaterial({color:e.color}),u=new l.Mesh(d,h);u.position.set(o,n+.4,r+.06),u.name="titlePlate_"+t,a.add(u);const m=new l.PlaneGeometry(1.9,.7),p=new l.MeshBasicMaterial({color:1710634}),v=new l.Mesh(m,p);return v.position.set(o,n-.15,r+.06),v.name="descPlate_"+t,a.add(v),a}(t,o,...[[-4,1.5,-3],[4,1.5,-3],[-4,1.5,3],[4,1.5,3]][o]);le.add(n);const r=n.getObjectByName("titlePlate_"+o),a=n.getObjectByName("descPlate_"+o);if(r){const o=e.world.createEntity();o.addComponent(B,{text:t.title,color:"#ffffff",fontSize:.07,anchor:"center",baseline:"middle",textAlign:"center"}).addComponent(C,{value:r}).addComponent(S,{x:0,y:0,z:.01});e.world.createEntity().addComponent(x,{value:r}).addComponent(_,{value:[o]}),me.push(o)}if(a){const o=e.world.createEntity();o.addComponent(B,{text:t.description,color:"#cccccc",fontSize:.04,anchor:"center",baseline:"top",textAlign:"center",maxWidth:1.7,lineHeight:1.3}).addComponent(C,{value:a}).addComponent(S,{x:0,y:.3,z:.01});e.world.createEntity().addComponent(x,{value:a}).addComponent(_,{value:[o]}),me.push(o)}});const m=new l.BoxGeometry(3,2,.2),p=new l.MeshBasicMaterial({color:2763322}),v=new l.Mesh(m,p);v.position.set(0,1.5,0),le.add(v);const f=new l.RingGeometry(.5,.6,32),w=new l.MeshBasicMaterial({color:4886754,side:l.DoubleSide}),y=new l.Mesh(f,w);y.position.set(0,2.5,0),y.rotation.x=-Math.PI/2,le.add(y),le.userData.trackingRing=y,de=function(e){return new l.ShaderMaterial({uniforms:{time:{value:0},selected:{value:0},tex:{value:e.assets.doorfx_tex}},vertexShader:e.shaders.basic_vert,fragmentShader:e.shaders.door_frag})}(e);const g=new l.BoxGeometry(1.5,2.5,.1);(he=new l.Mesh(g,de)).position.set(0,1.25,4.9),le.add(he);const M=new l.BoxGeometry(1.7,2.7,.08),b=new l.MeshBasicMaterial({color:1710618}),P=new l.Mesh(M,b);P.position.set(0,1.25,5),le.add(P);const E=new l.PlaneBufferGeometry(10,10),z=new l.MeshBasicMaterial({visible:!1}),G=new l.Mesh(E,z);G.rotation.x=-Math.PI/2,G.position.y=.001,le.add(G),e.raycontrol.addState("controllersDoor",{colliderMesh:he,onHover:(e,t)=>{he.scale.z=Math.min(he.scale.z+.05*(2-he.scale.z),2)},onHoverLeave:()=>{},onSelectStart:(t,o)=>{e.goto=0},onSelectEnd:e=>{}}),e.raycontrol.addState("controllersTeleport",{colliderMesh:G,onHover:(t,o)=>{e.teleport.onHover(t.point,o)},onHoverLeave:()=>{e.teleport.onHoverLeave()},onSelectStart:(t,o)=>{e.teleport.onSelectStart(o)},onSelectEnd:t=>{e.teleport.onSelectEnd(t.point)}})}function we(e){e.renderer.setClearColor(657946),e.scene.add(le),e.raycontrol.activateState("controllersDoor"),e.raycontrol.activateState("controllersTeleport")}function ye(e){e.raycontrol.deactivateState("controllersDoor"),e.raycontrol.deactivateState("controllersTeleport"),e.scene.remove(le)}function ge(e,t,o){if(de.uniforms.time.value=o,ue.forEach(e=>{e.rotation.y+=.5*t}),le.userData.trackingRing){const e=1+.2*Math.sin(3*o);le.userData.trackingRing.scale.set(e,e,1),le.userData.trackingRing.rotation.z+=.5*t}he.scale.z>1&&(he.scale.z=Math.max(he.scale.z-t*he.scale.z,1))}var Me,xe,be,Se=[],Ce=[];const Be=[{title:"Ray Casting",description:"Cast invisible ray from controller to find destination",color:5301186},{title:"Point & Click",description:"Simple point-to-teleport interaction model",color:4886754},{title:"Valid Targets",description:"Only teleport to walkable surfaces (floors, ground)",color:16098851},{title:"Smooth Transition",description:"Fade effect and camera movement for comfort",color:14702333}];function Pe(e){Me=new l.Scene;const t=new l.PlaneGeometry(10,10),o=new l.MeshBasicMaterial({color:1710638}),n=new l.Mesh(t,o);n.rotation.x=-Math.PI/2,Me.add(n);const r=new l.MeshBasicMaterial({color:2767434});[{pos:[0,2,-5],rot:[0,0,0]},{pos:[-5,2,0],rot:[0,Math.PI/2,0]},{pos:[5,2,0],rot:[0,-Math.PI/2,0]}].forEach(e=>{const t=new l.Mesh(new l.PlaneGeometry(10,4),r);t.position.set(...e.pos),t.rotation.set(...e.rot),Me.add(t)});const a=new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:657950}));a.rotation.x=Math.PI/2,a.position.y=4,Me.add(a);[{x:-3,z:-3,color:5301186},{x:3,z:-3,color:4886754},{x:-3,z:3,color:16098851},{x:3,z:3,color:14702333}].forEach((t,o)=>{const n=function(e,t,o){const n=new l.Group,r=new l.Mesh(new l.RingGeometry(.8,1,32),new l.MeshBasicMaterial({color:o,side:l.DoubleSide}));r.rotation.x=-Math.PI/2,r.position.y=.01,n.add(r);const a=new l.Mesh(new l.RingGeometry(.3,.5,32),new l.MeshBasicMaterial({color:16777215,side:l.DoubleSide}));a.rotation.x=-Math.PI/2,a.position.y=.02,n.add(a);const i=new l.Mesh(new l.CircleGeometry(.1,16),new l.MeshBasicMaterial({color:o}));return i.rotation.x=-Math.PI/2,i.position.y=.03,n.add(i),n.position.set(e,0,t),n.userData.animOffset=Math.random()*Math.PI*2,n}(t.x,t.z,t.color);Me.add(n),Se.push(n);const r=Be[o],a=function(e,t,o,n,r){const a=new l.BoxGeometry(2.5,1.5,.1),i=new l.MeshBasicMaterial({color:2763322}),s=new l.Mesh(a,i);s.position.set(o,n,r);const c=new l.PlaneGeometry(2.3,.4),d=new l.MeshBasicMaterial({color:e.color}),h=new l.Mesh(c,d);h.position.set(0,.5,.06),h.name="titlePlate_"+t,s.add(h);const u=new l.PlaneGeometry(2.3,.9),m=new l.MeshBasicMaterial({color:1710634}),p=new l.Mesh(u,m);return p.position.set(0,-.15,.06),p.name="descPlate_"+t,s.add(p),s}(r,o,t.x,2,t.z-1.5);Me.add(a);const i=a.getObjectByName("titlePlate_"+o),s=a.getObjectByName("descPlate_"+o);if(i){const t=e.world.createEntity();t.addComponent(B,{text:r.title,color:"#ffffff",fontSize:.07,anchor:"center",baseline:"middle",textAlign:"center"}).addComponent(C,{value:i}).addComponent(S,{x:0,y:0,z:.01});e.world.createEntity().addComponent(x,{value:i}).addComponent(_,{value:[t]}),Ce.push(t)}if(s){const t=e.world.createEntity();t.addComponent(B,{text:r.description,color:"#cccccc",fontSize:.04,anchor:"center",baseline:"top",textAlign:"center",maxWidth:2.1,lineHeight:1.3}).addComponent(C,{value:s}).addComponent(S,{x:0,y:.4,z:.01});e.world.createEntity().addComponent(x,{value:s}).addComponent(_,{value:[t]}),Ce.push(t)}});const i=new l.CylinderGeometry(.01,.01,4,8),s=new l.MeshBasicMaterial({color:5301186,transparent:!0,opacity:.5}),c=new l.Mesh(i,s);c.position.set(0,2,0),c.rotation.x=Math.PI/4,Me.add(c),Me.userData.laser=c;const d=new l.BoxGeometry(.1,.15,.05),h=new l.MeshBasicMaterial({color:4886754}),u=new l.Mesh(d,h);u.position.set(0,3,0),Me.add(u),Me.userData.controller=u,xe=function(e){return new l.ShaderMaterial({uniforms:{time:{value:0},selected:{value:0},tex:{value:e.assets.doorfx_tex}},vertexShader:e.shaders.basic_vert,fragmentShader:e.shaders.door_frag})}(e);const m=new l.BoxGeometry(1.5,2.5,.1);(be=new l.Mesh(m,xe)).position.set(0,1.25,4.9),Me.add(be);const p=new l.BoxGeometry(1.7,2.7,.08),v=new l.MeshBasicMaterial({color:1710618}),f=new l.Mesh(p,v);f.position.set(0,1.25,5),Me.add(f);const w=new l.PlaneBufferGeometry(10,10),y=new l.MeshBasicMaterial({visible:!1}),g=new l.Mesh(w,y);g.rotation.x=-Math.PI/2,g.position.y=.001,Me.add(g),e.raycontrol.addState("teleportDoor",{colliderMesh:be,onHover:(e,t)=>{be.scale.z=Math.min(be.scale.z+.05*(2-be.scale.z),2)},onHoverLeave:()=>{},onSelectStart:(t,o)=>{e.goto=0},onSelectEnd:e=>{}}),e.raycontrol.addState("teleportRoomTeleport",{colliderMesh:g,onHover:(t,o)=>{e.teleport.onHover(t.point,o)},onHoverLeave:()=>{e.teleport.onHoverLeave()},onSelectStart:(t,o)=>{e.teleport.onSelectStart(o)},onSelectEnd:t=>{e.teleport.onSelectEnd(t.point)}})}function Ee(e){e.renderer.setClearColor(657946),e.scene.add(Me),e.raycontrol.activateState("teleportDoor"),e.raycontrol.activateState("teleportRoomTeleport")}function ze(e){e.raycontrol.deactivateState("teleportDoor"),e.raycontrol.deactivateState("teleportRoomTeleport"),e.scene.remove(Me)}function Ge(e,t,o){xe.uniforms.time.value=o,Se.forEach(e=>{const t=1+.1*Math.sin(3*o+e.userData.animOffset);e.children[0].scale.set(t,t,1),e.children[1].scale.set(.8*t,.8*t,1)}),Me.userData.laser&&Me.userData.controller&&(Me.userData.controller.rotation.y+=.3*t,Me.userData.laser.rotation.y=Me.userData.controller.rotation.y,Me.userData.laser.rotation.x=Math.PI/4+.3*Math.sin(2*o)),be.scale.z>1&&(be.scale.z=Math.max(be.scale.z-t*be.scale.z,1))}var De,Ve,_e,He=[],Le=[];const Ie=[{title:"glTF Format",desc:"Standard runtime format for WebXR",color:16098851},{title:"DRACO Compression",desc:"Geometry compression for smaller files",color:4886754},{title:"Materials & Textures",desc:"PBR materials for realistic rendering",color:5301186},{title:"Animations",desc:"Skeletal and vertex animations",color:14702333}];function ke(e){De=new l.Scene;const t=new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:1710638}));t.rotation.x=-Math.PI/2,De.add(t);const o=new l.MeshBasicMaterial({color:2767434});[[0,2,-5,0],[-5,2,0,Math.PI/2],[5,2,0,-Math.PI/2]].forEach(([e,t,n,r])=>{const a=new l.Mesh(new l.PlaneGeometry(10,4),o);a.position.set(e,t,n),a.rotation.y=r,De.add(a)});const n=new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:657950}));n.rotation.x=Math.PI/2,n.position.y=4,De.add(n);[[-3,-3],[3,-3],[-3,3],[3,3]].forEach(([t,o],n)=>{!function(e,t,o){const n=new l.Group,r=new l.BoxGeometry(1.5,.1,1.5),a=new l.MeshBasicMaterial({color:1710634}),i=new l.Mesh(r,a);i.position.set(e,.05,t),n.add(i);const s=new l.BoxGeometry(.8,1,.8),c=new l.MeshBasicMaterial({color:2763322}),d=new l.Mesh(s,c);d.position.set(e,.6,t),n.add(d);const h=new l.CylinderGeometry(.6,.7,.1,16),u=new l.MeshBasicMaterial({color:o}),m=new l.Mesh(h,u);m.position.set(e,1.15,t),n.add(m);const p=new l.BoxGeometry(.4,.4,.4),v=new l.MeshBasicMaterial({color:o,wireframe:!0}),f=new l.Mesh(p,v);f.position.set(e,1.5,t),f.userData.rotating=!0,n.add(f),He.push(f)}(t,o,Ie[n].color);const r=function(e,t,o,n,r,a){const i=new l.Group,s=new l.BoxGeometry(2,1.2,.1),c=new l.MeshBasicMaterial({color:2763322}),d=new l.Mesh(s,c);d.position.set(o,n,r),d.lookAt(a),i.add(d);const h=new l.PlaneGeometry(1.8,.3),u=new l.MeshBasicMaterial({color:e.color}),m=new l.Mesh(h,u);m.position.set(0,.3,.06),m.name="titlePlate_"+t,d.add(m);const p=new l.PlaneGeometry(1.8,.7),v=new l.MeshBasicMaterial({color:1710634}),f=new l.Mesh(p,v);return f.position.set(0,-.15,.06),f.name="descPlate_"+t,d.add(f),i}(Ie[n],n,t,2.5,o-2.5,{x:t,y:2.5,z:o});De.add(r);const a=r.getObjectByName("titlePlate_"+n),i=r.getObjectByName("descPlate_"+n);if(a){const t=e.world.createEntity();t.addComponent(B,{text:Ie[n].title,color:"#ffffff",fontSize:.07,anchor:"center",baseline:"middle",textAlign:"center"}).addComponent(C,{value:a}).addComponent(S,{x:0,y:0,z:.01});e.world.createEntity().addComponent(x,{value:a}).addComponent(_,{value:[t]}),Le.push(t)}if(i){const t=e.world.createEntity();t.addComponent(B,{text:Ie[n].desc,color:"#cccccc",fontSize:.04,anchor:"center",baseline:"top",textAlign:"center",maxWidth:1.6,lineHeight:1.3}).addComponent(C,{value:i}).addComponent(S,{x:0,y:.3,z:.01});e.world.createEntity().addComponent(x,{value:i}).addComponent(_,{value:[t]}),Le.push(t)}}),Ve=function(e){return new l.ShaderMaterial({uniforms:{time:{value:0},selected:{value:0},tex:{value:e.assets.doorfx_tex}},vertexShader:e.shaders.basic_vert,fragmentShader:e.shaders.door_frag})}(e),(_e=new l.Mesh(new l.BoxGeometry(1.5,2.5,.1),Ve)).position.set(0,1.25,4.9),De.add(_e);const r=new l.Mesh(new l.BoxGeometry(1.7,2.7,.08),new l.MeshBasicMaterial({color:1710618}));r.position.set(0,1.25,5),De.add(r);const a=new l.Mesh(new l.PlaneBufferGeometry(10,10),new l.MeshBasicMaterial({visible:!1}));a.rotation.x=-Math.PI/2,a.position.y=.001,De.add(a),e.raycontrol.addState("modelsDoor",{colliderMesh:_e,onHover:(e,t)=>{_e.scale.z=Math.min(_e.scale.z+.05*(2-_e.scale.z),2)},onHoverLeave:()=>{},onSelectStart:(t,o)=>{e.goto=0},onSelectEnd:e=>{}}),e.raycontrol.addState("modelsTeleport",{colliderMesh:a,onHover:(t,o)=>{e.teleport.onHover(t.point,o)},onHoverLeave:()=>{e.teleport.onHoverLeave()},onSelectStart:(t,o)=>{e.teleport.onSelectStart(o)},onSelectEnd:t=>{e.teleport.onSelectEnd(t.point)}})}function Oe(e){e.renderer.setClearColor(657946),e.scene.add(De),e.raycontrol.activateState("modelsDoor"),e.raycontrol.activateState("modelsTeleport")}function Ae(e){e.raycontrol.deactivateState("modelsDoor"),e.raycontrol.deactivateState("modelsTeleport"),e.scene.remove(De)}function Re(e,t,o){Ve.uniforms.time.value=o,He.forEach(e=>{e.rotation.x+=.5*t,e.rotation.y+=.3*t}),_e.scale.z>1&&(_e.scale.z=Math.max(_e.scale.z-t*_e.scale.z,1))}var je,Te,We,Fe=[],Ne=[];const qe=[{title:"Positional Audio",desc:"Sound sources have 3D positions",color:14702333},{title:"Distance Decay",desc:"Volume decreases with distance",color:4886754},{title:"Spatial Effects",desc:"HRTF for realistic 3D sound",color:5301186},{title:"Multiple Sources",desc:"Many sounds can play simultaneously",color:16098851}];function Ue(e){je=new l.Scene;je.add(new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:1710638})).rotateX(-Math.PI/2));const t=new l.MeshBasicMaterial({color:2767434});[[0,2,-5,0],[-5,2,0,Math.PI/2],[5,2,0,-Math.PI/2]].forEach(([e,o,n,r])=>{const a=new l.Mesh(new l.PlaneGeometry(10,4),t);a.position.set(e,o,n),a.rotation.y=r,je.add(a)});const o=new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:657950}));o.rotation.x=Math.PI/2,o.position.y=4,je.add(o);[[-3,1.5,-3],[3,1.5,-3],[-3,1.5,3],[3,1.5,3]].forEach(([t,o,n],r)=>{!function(e,t,o,n){const r=new l.Group,a=new l.SphereGeometry(.3,16,16),i=new l.MeshBasicMaterial({color:n,transparent:!0,opacity:.7}),s=new l.Mesh(a,i);s.position.set(e,t,o),r.add(s);const c=new l.RingGeometry(.4,.5,32),d=new l.MeshBasicMaterial({color:n,side:l.DoubleSide,transparent:!0,opacity:.5}),h=new l.Mesh(c,d);h.position.set(e,t,o),h.lookAt(e,t+1,o),r.add(h),r.userData.animOffset=Math.random()*Math.PI*2,Fe.push({sphere:s,ring:h,offset:r.userData.animOffset})}(t,o,n,qe[r].color);const a=new l.Mesh(new l.BoxGeometry(2,1,.1),new l.MeshBasicMaterial({color:2763322}));a.position.set(t,2.5,n),je.add(a);const i=new l.Mesh(new l.PlaneGeometry(1.8,.25),new l.MeshBasicMaterial({color:qe[r].color}));i.position.set(0,.3,.06),i.name="titlePlate_"+r,a.add(i);const s=new l.Mesh(new l.PlaneGeometry(1.8,.55),new l.MeshBasicMaterial({color:1710634}));s.position.set(0,-.12,.06),s.name="descPlate_"+r,a.add(s);const c=e.world.createEntity();c.addComponent(B,{text:qe[r].title,color:"#ffffff",fontSize:.065,anchor:"center",baseline:"middle",textAlign:"center"}).addComponent(C,{value:i}).addComponent(S,{x:0,y:0,z:.01});e.world.createEntity().addComponent(x,{value:i}).addComponent(_,{value:[c]}),Ne.push(c);const d=e.world.createEntity();d.addComponent(B,{text:qe[r].desc,color:"#cccccc",fontSize:.04,anchor:"center",baseline:"top",textAlign:"center",maxWidth:1.6,lineHeight:1.3}).addComponent(C,{value:s}).addComponent(S,{x:0,y:.25,z:.01});e.world.createEntity().addComponent(x,{value:s}).addComponent(_,{value:[d]}),Ne.push(d)});const n=new l.Group;for(let e=0;e<5;e++){const t=new l.Mesh(new l.RingGeometry(.5+.3*e,.6+.3*e,32),new l.MeshBasicMaterial({color:14702333,side:l.DoubleSide,transparent:!0,opacity:.3-.05*e}));t.rotation.x=-Math.PI/2,n.add(t)}n.position.set(0,.1,0),je.add(n),je.userData.waves=n,Te=function(e){return new l.ShaderMaterial({uniforms:{time:{value:0},selected:{value:0},tex:{value:e.assets.doorfx_tex}},vertexShader:e.shaders.basic_vert,fragmentShader:e.shaders.door_frag})}(e),(We=new l.Mesh(new l.BoxGeometry(1.5,2.5,.1),Te)).position.set(0,1.25,4.9),je.add(We);const r=new l.Mesh(new l.BoxGeometry(1.7,2.7,.08),new l.MeshBasicMaterial({color:1710618}));r.position.set(0,1.25,5),je.add(r);const a=new l.Mesh(new l.PlaneBufferGeometry(10,10),new l.MeshBasicMaterial({visible:!1}));a.rotation.x=-Math.PI/2,a.position.y=.001,je.add(a),e.raycontrol.addState("audioDoor",{colliderMesh:We,onHover:(e,t)=>{We.scale.z=Math.min(We.scale.z+.05*(2-We.scale.z),2)},onHoverLeave:()=>{},onSelectStart:(t,o)=>{e.goto=0},onSelectEnd:e=>{}}),e.raycontrol.addState("audioTeleport",{colliderMesh:a,onHover:(t,o)=>{e.teleport.onHover(t.point,o)},onHoverLeave:()=>{e.teleport.onHoverLeave()},onSelectStart:(t,o)=>{e.teleport.onSelectStart(o)},onSelectEnd:t=>{e.teleport.onSelectEnd(t.point)}})}function Xe(e){e.renderer.setClearColor(657946),e.scene.add(je),e.raycontrol.activateState("audioDoor"),e.raycontrol.activateState("audioTeleport")}function Ye(e){e.raycontrol.deactivateState("audioDoor"),e.raycontrol.deactivateState("audioTeleport"),e.scene.remove(je)}function $e(e,t,o){Te.uniforms.time.value=o,Fe.forEach(({sphere:e,ring:t,offset:n})=>{const r=1+.2*Math.sin(3*o+n);e.scale.set(r,r,r);const a=1+.3*Math.sin(2*o+n);t.scale.set(a,a,1)}),je.userData.waves&&je.userData.waves.children.forEach((e,t)=>{e.scale.set(1+.5*Math.sin(2*o-.5*t),1+.5*Math.sin(2*o-.5*t),1)}),We.scale.z>1&&(We.scale.z=Math.max(We.scale.z-t*We.scale.z,1))}var Je,Ze,Ke,Qe=[],et=[];const tt=[{title:"Ray Casting",desc:"Laser pointer for distant selection",color:16739179},{title:"Hover States",desc:"Visual feedback on look/hover",color:4886754},{title:"Grab & Throw",desc:"Pick up and manipulate objects",color:5301186},{title:"UI Interaction",desc:"Buttons, sliders, menus in VR",color:16098851}];function ot(e){Je=new l.Scene;Je.add(new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:1710638})).rotateX(-Math.PI/2));const t=new l.MeshBasicMaterial({color:2767434});[[0,2,-5,0],[-5,2,0,Math.PI/2],[5,2,0,-Math.PI/2]].forEach(([e,o,n,r])=>{const a=new l.Mesh(new l.PlaneGeometry(10,4),t);a.position.set(e,o,n),a.rotation.y=r,Je.add(a)});const o=new l.Mesh(new l.PlaneGeometry(10,10),new l.MeshBasicMaterial({color:657950}));o.rotation.x=Math.PI/2,o.position.y=4,Je.add(o);[[-3,1.5,-3],[3,1.5,-3],[-3,1.5,3],[3,1.5,3]].forEach(([t,o,n],r)=>{!function(e,t,o,n){const r=new l.Group,a=new l.BoxGeometry(.5,.5,.5),i=new l.MeshBasicMaterial({color:n,wireframe:!0}),s=new l.Mesh(a,i);s.position.set(e,t,o),s.userData.hovered=!1,r.add(s),Qe.push(s);const c=new l.RingGeometry(.4,.5,32),d=new l.MeshBasicMaterial({color:n,side:l.DoubleSide}),h=new l.Mesh(c,d);h.rotation.x=-Math.PI/2,h.position.set(e,.01,o),r.add(h);const u=new l.Mesh(new l.CylinderGeometry(.3,.4,t,8),new l.MeshBasicMaterial({color:1710634}));u.position.set(e,t/2,o),r.add(u)}(t,o,n,tt[r].color);const a=new l.Mesh(new l.BoxGeometry(2,1,.1),new l.MeshBasicMaterial({color:2763322}));a.position.set(t,2.8,n-1.5),a.lookAt(t,2.8,n),Je.add(a);const i=new l.Mesh(new l.PlaneGeometry(1.8,.25),new l.MeshBasicMaterial({color:tt[r].color}));i.position.set(0,.3,.06),i.name="titlePlate_"+r,a.add(i);const s=new l.Mesh(new l.PlaneGeometry(1.8,.55),new l.MeshBasicMaterial({color:1710634}));s.position.set(0,-.12,.06),s.name="descPlate_"+r,a.add(s);const c=e.world.createEntity();c.addComponent(B,{text:tt[r].title,color:"#ffffff",fontSize:.065,anchor:"center",baseline:"middle",textAlign:"center"}).addComponent(C,{value:i}).addComponent(S,{x:0,y:0,z:.01});e.world.createEntity().addComponent(x,{value:i}).addComponent(_,{value:[c]}),et.push(c);const d=e.world.createEntity();d.addComponent(B,{text:tt[r].desc,color:"#cccccc",fontSize:.04,anchor:"center",baseline:"top",textAlign:"center",maxWidth:1.6,lineHeight:1.3}).addComponent(C,{value:s}).addComponent(S,{x:0,y:.25,z:.01});e.world.createEntity().addComponent(x,{value:s}).addComponent(_,{value:[d]}),et.push(d)});const n=function(){const e=new l.Group,t=new l.CylinderGeometry(.005,.005,3,8),o=new l.MeshBasicMaterial({color:16739179,transparent:!0,opacity:.7}),n=new l.Mesh(t,o);n.position.set(0,1.5,0),n.rotation.x=Math.PI/2,e.add(n);const r=new l.Mesh(new l.BoxGeometry(.08,.12,.04),new l.MeshBasicMaterial({color:4886754}));return r.position.set(0,1.5,0),e.add(r),e}();Je.add(n),Je.userData.laserVisual=n,Ze=function(e){return new l.ShaderMaterial({uniforms:{time:{value:0},selected:{value:0},tex:{value:e.assets.doorfx_tex}},vertexShader:e.shaders.basic_vert,fragmentShader:e.shaders.door_frag})}(e),(Ke=new l.Mesh(new l.BoxGeometry(1.5,2.5,.1),Ze)).position.set(0,1.25,4.9),Je.add(Ke);const r=new l.Mesh(new l.BoxGeometry(1.7,2.7,.08),new l.MeshBasicMaterial({color:1710618}));r.position.set(0,1.25,5),Je.add(r);const a=new l.Mesh(new l.PlaneBufferGeometry(10,10),new l.MeshBasicMaterial({visible:!1}));a.rotation.x=-Math.PI/2,a.position.y=.001,Je.add(a),e.raycontrol.addState("interactionDoor",{colliderMesh:Ke,onHover:(e,t)=>{Ke.scale.z=Math.min(Ke.scale.z+.05*(2-Ke.scale.z),2)},onHoverLeave:()=>{},onSelectStart:(t,o)=>{e.goto=0},onSelectEnd:e=>{}}),e.raycontrol.addState("interactionTeleport",{colliderMesh:a,onHover:(t,o)=>{e.teleport.onHover(t.point,o)},onHoverLeave:()=>{e.teleport.onHoverLeave()},onSelectStart:(t,o)=>{e.teleport.onSelectStart(o)},onSelectEnd:t=>{e.teleport.onSelectEnd(t.point)}})}function nt(e){e.renderer.setClearColor(657946),e.scene.add(Je),e.raycontrol.activateState("interactionDoor"),e.raycontrol.activateState("interactionTeleport")}function rt(e){e.raycontrol.deactivateState("interactionDoor"),e.raycontrol.deactivateState("interactionTeleport"),e.scene.remove(Je)}function at(e,t,o){if(Ze.uniforms.time.value=o,Qe.forEach((e,n)=>{e.rotation.x+=.3*t,e.rotation.y+=.5*t;const r=Math.sin(2*o+n)>0;r&&!e.userData.hovered?(e.material.color.setHex(16777215),e.userData.hovered=!0):!r&&e.userData.hovered&&(e.material.color.setHex(tt[n].color),e.userData.hovered=!1)}),Je.userData.laserVisual){Je.userData.laserVisual.rotation.y+=.5*t;Je.userData.laserVisual.children[0].material.opacity=.5+.3*Math.sin(5*o)}Ke.scale.z>1&&(Ke.scale.z=Math.max(Ke.scale.z-t*Ke.scale.z,1))}var it={door_frag:"\nuniform float time;\nuniform float selected;\nuniform sampler2D tex;\nvarying vec2 vUv;\n\nvoid main( void ) {\n  float t = time;\n  vec2 uv = vUv * 2.0 - 1.0;\n  vec2 puv = vec2(length(uv.xy), atan(uv.x, uv.y));\n  vec4 col = texture2D(tex, vec2(log(puv.x) + t / 5.0, puv.y / 3.1415926 ));\n  float glow = (1.0 - puv.x) * (0.5 + (sin(t) + 2.0 ) / 4.0);\n  // blue glow\n  col += vec4(118.0/255.0, 144.0/255.0, 219.0/255.0, 1.0) * (0.4 + glow * 1.0);\n  // white glow\n  col += vec4(0.2) * smoothstep(0.0, 2.0, glow * glow);\n  gl_FragColor = col;\n\n}\n",zoom_frag:"\nuniform float time;\nuniform sampler2D tex;\nuniform vec2 zoomPos;\nuniform float zoomAmount;\nuniform float zoomRatio;\nvarying vec2 vUv;\n\nvoid main( void ) {\n  float t = time;\n  vec2 uv = vec2(vUv.x - 0.5, (1.0 - vUv.y) - 0.5);\n  vec2 texUv = uv * vec2(zoomRatio, 1.0);\n  vec4 col = texture2D(tex, zoomPos + texUv * zoomAmount);\n  float dist = length(uv) * 2.0;\n  col.a = smoothstep(0.0, 0.1, 1.0 - dist);\n  float aura = smoothstep(0.80, 1.0, dist);\n  col.rgb += aura * 0.3;\n  gl_FragColor = col;\n}\n",basic_vert:"\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvoid main()\n{\n  vUv = uv;\n  vPosition = position;\n  vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * mvPosition;\n}\n",panoball_vert:"\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec3 vWorldPos;\nuniform float time;\nuniform float selected;\n\nmat4 inverse(mat4 m) {\n  float\n      a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n      a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n      a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n      a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n      b00 = a00 * a11 - a01 * a10,\n      b01 = a00 * a12 - a02 * a10,\n      b02 = a00 * a13 - a03 * a10,\n      b03 = a01 * a12 - a02 * a11,\n      b04 = a01 * a13 - a03 * a11,\n      b05 = a02 * a13 - a03 * a12,\n      b06 = a20 * a31 - a21 * a30,\n      b07 = a20 * a32 - a22 * a30,\n      b08 = a20 * a33 - a23 * a30,\n      b09 = a21 * a32 - a22 * a31,\n      b10 = a21 * a33 - a23 * a31,\n      b11 = a22 * a33 - a23 * a32,\n\n      det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat4(\n      a11 * b11 - a12 * b10 + a13 * b09,\n      a02 * b10 - a01 * b11 - a03 * b09,\n      a31 * b05 - a32 * b04 + a33 * b03,\n      a22 * b04 - a21 * b05 - a23 * b03,\n      a12 * b08 - a10 * b11 - a13 * b07,\n      a00 * b11 - a02 * b08 + a03 * b07,\n      a32 * b02 - a30 * b05 - a33 * b01,\n      a20 * b05 - a22 * b02 + a23 * b01,\n      a10 * b10 - a11 * b08 + a13 * b06,\n      a01 * b08 - a00 * b10 - a03 * b06,\n      a30 * b04 - a31 * b02 + a33 * b00,\n      a21 * b02 - a20 * b04 - a23 * b00,\n      a11 * b07 - a10 * b09 - a12 * b06,\n      a00 * b09 - a01 * b07 + a02 * b06,\n      a31 * b01 - a30 * b03 - a32 * b00,\n      a20 * b03 - a21 * b01 + a22 * b00) / det;\n}\n\n\nmat4 transpose(in mat4 m) {\n  vec4 i0 = m[0];\n  vec4 i1 = m[1];\n  vec4 i2 = m[2];\n  vec4 i3 = m[3];\n\n  return mat4(\n    vec4(i0.x, i1.x, i2.x, i3.x),\n    vec4(i0.y, i1.y, i2.y, i3.y),\n    vec4(i0.z, i1.z, i2.z, i3.z),\n    vec4(i0.w, i1.w, i2.w, i3.w)\n  );\n}\n\nvoid main()\n{\n  vUv = uv;\n\n  vPosition = position;\n\n  vec3 offset = vec3(\n    sin(position.x * 50.0 + time),\n    sin(position.y * 10.0 + time * 2.0),\n    cos(position.z * 40.0 + time)\n  ) * 0.003;\n\n  vPosition *= 1.0 + selected * 0.2;\n\n  vNormal = normalize(inverse(transpose(modelMatrix)) * vec4(normalize(normal), 1.0)).xyz;\n  vWorldPos = (modelMatrix * vec4(vPosition, 1.0)).xyz;\n\n  vec4 mvPosition = modelViewMatrix * vec4(vPosition + offset, 1.0);\n  gl_Position = projectionMatrix * mvPosition;\n}\n",panoball_frag:"\nuniform sampler2D tex, texfx;\nuniform float time;\nuniform float selected;\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec3 vWorldPos;\n\n\nvoid main( void ) {\n  vec2 uv = vUv;\n  //uv.y =  1.0 - uv.y;\n\n  vec3 eye = normalize(cameraPosition - vWorldPos);\n  float fresnel = abs(dot(eye, vNormal));\n  float shift = pow((1.0 - fresnel), 4.0) * 0.05;\n\n  vec3 col = vec3(\n    texture2D(tex, uv - shift).r,\n    texture2D(tex, uv).g,\n    texture2D(tex, uv + shift).b\n  );\n\n  col = mix(col * 0.7, vec3(1.0), 0.7 - fresnel);\n\n  col += selected * 0.3;\n\n  float t = time * 0.4 + vPosition.x + vPosition.z;\n  uv = vec2(vUv.x + t * 0.2, vUv.y + t);\n  vec3 fx = texture2D(texfx, uv).rgb * 0.4;\n\n\n  gl_FragColor = vec4(col + fx, 1.0);\n}\n",beam_frag:"\nuniform float time;\nuniform sampler2D tex;\nvarying vec2 vUv;\n\nvoid main( void ) {\n  float t = time;\n  vec4 col = texture2D(tex, vec2(vUv.x, vUv.y * 3.0 + time * 2.0));\n  col *= vUv.y;\n  gl_FragColor = col;\n}\n"};new(o(10).a);var st,ct,lt,dt,ht,ut,mt,pt,vt,ft=new l.Clock,wt={},yt=[],gt=[n,r,a,i,s,c];const Mt=["landing","controllers","teleport","models","audio","interaction"],xt=[!1,!1,!1,!1,!1,!1],bt=new URL(window.location),St=bt.searchParams.get("room");wt.room=-1!==Mt.indexOf(St)?Mt.indexOf(St):0;const Ct=bt.searchParams.has("debug"),Bt=bt.searchParams.has("handedness")?bt.searchParams.get("handedness"):"right",Pt={landing:{},controllers:{landing:new l.Vector3(0,0,-5)},teleport:{landing:new l.Vector3(0,0,-5)},models:{landing:new l.Vector3(0,0,-5)},audio:{landing:new l.Vector3(0,0,-5)},interaction:{landing:new l.Vector3(0,0,-5)}};function Et(e){gt[wt.room].exit(wt),ut.deactivateAll();const t=Mt[wt.room],o=Mt[e];if(Pt[t]&&Pt[t][o]){let e=new l.Vector3;const r=Pt[t][o];var n=lt.xr.getCamera(wt.camera);e.x=n.position.x-r.x,e.z=n.position.z-r.z,wt.cameraRig.position.sub(e)}wt.room=e,function(e){vt.source&&vt.stop();const t=xt[e];if(!t)return;vt.setBuffer(X[t]),vt.setLoop(!0),vt.setVolume(1),vt.offset=60*Math.random(),vt.play()}(e),gt[wt.room].enter(wt)}var zt,Gt={};function Dt(){const e=document.getElementById(Bt+"hand");e&&e.classList.add("activehand"),function(){if("xr"in navigator)navigator.xr.isSessionSupported("immersive-vr").then(e=>{const t=document.getElementById("no-webxr");!e&&t&&t.classList.remove("hidden")});else{const e=document.getElementById("no-webxr");e&&e.classList.remove("hidden")}}();(zt=new g.e).registerSystem(I).registerSystem(A).registerSystem(R).registerSystem(O).registerSystem(F).registerSystem(q).registerSystem(j),Gt.roomHall=new U(zt,[A,R,O]),(lt=new l.WebGLRenderer({antialias:!0,logarithmicDepthBuffer:!1,powerPreference:"high-performance",preserveDrawingBuffer:!1,failIfMajorPerformanceCaveat:!1})).gammaFactor=2.2,lt.outputEncoding=l.sRGBEncoding,lt.setPixelRatio(Math.min(window.devicePixelRatio,2)),lt.setSize(window.innerWidth,window.innerHeight),lt.xr.enabled=!0,lt.sortObjects=!1,lt.autoClear=!0,lt.autoClearDepth=!0,lt.autoClearStencil=!0,st=new l.Scene,(dt=new l.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.005,1e4)).position.set(0,1.6,0),pt=new l.AudioListener,dt.add(pt),vt=new l.Audio(pt),ht=new d.a(dt,lt.domElement),document.body.addEventListener("click",()=>{wt.vrMode||ht.lock()});var t=!1,o=!1,n=!1,r=!1;document.addEventListener("keydown",e=>{switch(e.keyCode){case 87:case 38:t=!0;break;case 65:case 37:n=!0;break;case 83:case 40:o=!0;break;case 68:case 39:r=!0;break;case 78:wt.vrMode||Et((wt.room+1)%gt.length)}}),document.addEventListener("keyup",e=>{switch(e.keyCode){case 87:case 38:t=!1;break;case 65:case 37:n=!1;break;case 83:case 40:o=!1;break;case 68:case 39:r=!1}}),wt.browserControls={controls:ht,moveForward:()=>t,moveBackward:()=>o,moveLeft:()=>n,moveRight:()=>r},Ct&&document.body.addEventListener("keydown",e=>{switch(e.keyCode){case 87:ht.moveForward(.2);break;case 65:ht.moveRight(-.2);break;case 83:ht.moveForward(-.2);break;case 68:ht.moveRight(.2);break;case 78:Et((wt.room+1)%gt.length);break;default:var t=e.keyCode-48;!e.metaKey&&t>=0&&t<gt.length&&Et(t)}}),st.add(ht.getObject()),ct=new l.Object3D,st.add(ct),window.addEventListener("resize",kt,!1);for(let e=0;e<2;e++)yt[e]=lt.xr.getController(e),yt[e].raycaster=new l.Raycaster,yt[e].raycaster.near=.1,yt[e].addEventListener("selectstart",Lt),yt[e].addEventListener("selectend",It);const a=new l.DirectionalLight(15663103);a.name="sun",a.position.set(.2,1,.1);const i=new l.DirectionalLight(16773358,.3);i.name="fillLight",i.position.set(-.2,-1,-.1),st.add(a,i);var s=new l.Group;s.add(dt),s.add(yt[0]),s.add(yt[1]),s.position.set(0,0,2),st.add(s),wt.vrMode=!1,wt.assets=X,wt.shaders=it,wt.scene=ct,wt.renderer=lt,wt.camera=dt,wt.audioListener=pt,wt.goto=null,wt.cameraRig=s,wt.controllers=yt,wt.world=zt,wt.systemsGroup=Gt,wt.handedness=Bt,window.context=wt;const c=Object.keys(X).length;!function(e,t,o,n,r,a){t&&"/"!=t[t.length-1]&&(t+="/");var i=new m.a;i.setTranscoderPath("src/vendor/"),i.detectSupport(e);var s=new p.a,c=new f.a;c.setDecoderPath("src/vendor/"),s.setDRACOLoader(c);var d=new l.TextureLoader,h={gltf:s,glb:s,obj:new v.a,gif:d,png:d,jpg:d,basis:i,font:new l.FontLoader,ogg:new l.AudioLoader};for(var u in o){let e=u,i=o[u].url;o[u].loading=!0;let s=i.substr(i.lastIndexOf(".")+1).toLowerCase();h[s].load(t+i,t=>{a&&console.info(`%c ${i} loaded`,"color:green");var c=o[e].options;if(o[e]="font"==s?t.data:t,void 0!==c){void 0!==c.repeat&&(o[e].repeat.set(c.repeat[0],c.repeat[1]),delete c.repeat);for(let t in c)o[e][t]=c[t];r&&r(w(o))}n&&y(o)&&n()},()=>{},t=>{console.error("Error loading asset",i,t),"ogg"===s&&(o[e]=null,o[e].loading=!1,n&&y(o)&&n())})}}(lt,"assets/",X,()=>{ut=new Z(wt,Bt),wt.raycontrol=ut,mt=new K(wt),wt.teleport=mt,function(){var e=X.generic_controller_model.scene,t=new l.MeshLambertMaterial({map:X.controller_tex});e.getObjectByName("body").material=t,e.getObjectByName("trigger").material=t;for(let t=0;t<2;t++){let o=yt[t];o.boundingBox=new l.Box3,o.userData.grabbing=null,o.addEventListener("connected",(function(t){this.add(e.clone()),ut.addController(this,t.data)})),o.addEventListener("disconnect",(function(){this.remove(this.children[0]),ut.removeController(this,event.data)}))}}(),ae(wt),fe(wt),Pe(wt),ke(wt),Ue(wt),ot(wt),gt[wt.room].enter(wt),document.body.appendChild(lt.domElement),document.body.appendChild(h(lt,e=>{wt.vrMode="sessionStarted"===e,wt.vrMode&&(Et(0),wt.cameraRig.position.set(0,0,2),wt.goto=null)})),lt.setAnimationLoop(Ot),document.getElementById("loading").style.display="none"},e=>{document.querySelector("#progressbar").setAttribute("stroke-dashoffset",-(282-Math.floor(e/c*282)))},Ct)}var Vt={},_t={},Ht=-1!==navigator.userAgent.indexOf("OculusBrowser")&&parseInt(navigator.userAgent.match(/OculusBrowser\/([0-9]+)./)[1])<8;function Lt(e){if(Ht){const t=e.target;if(!Vt[t])return void(Vt[t]=!0);Vt[t]=!1}e.target.getObjectByName("trigger").rotation.x=-.3,ut.onSelectStart(e)}function It(e){if(Ht){const t=e.target;if(!_t[t])return void(_t[t]=!0);_t[t]=!1}e.target.getObjectByName("trigger").rotation.x=0,ut.onSelectEnd(e)}function kt(){dt.aspect=window.innerWidth/window.innerHeight,dt.updateProjectionMatrix(),lt.setSize(window.innerWidth,window.innerHeight)}function Ot(){var e=ft.getDelta(),t=ft.elapsedTime;zt.execute(e,t);for(let e=0;e<yt.length;e++){const t=yt[e].getObjectByName("Scene");t&&yt[e].boundingBox.setFromObject(t)}if(!wt.vrMode&&wt.browserControls){const t=3,o=wt.browserControls;o.controls.isLocked&&(o.moveForward()&&wt.camera.translateZ(-t*e),o.moveBackward()&&wt.camera.translateZ(t*e),o.moveLeft()&&wt.camera.translateX(-t*e),o.moveRight()&&wt.camera.translateX(t*e))}wt.raycontrol.execute(wt,e,t),gt[wt.room].execute(wt,e,t),lt.render(st,dt),null!==wt.goto&&(Et(wt.goto),wt.goto=null)}window.onload=()=>{Dt()}}});
//# sourceMappingURL=bundle.js.map